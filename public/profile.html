<!DOCTYPE html>
<html>

<head>
    <title>User Profile</title>
</head>

<body>
    <h1>User Profile</h1>
    <div id="userNameContainer">
        User Name: <span id="userName"></span>
    </div>

    <script>
        // Example of setting the token in a cookie in the frontend after successful login
        // // You can customize this based on your frontend setup
        // document.cookie = `token=${response.data.token}; Secure; HttpOnly; SameSite=Strict`;

        // async function fetchUserName(email) {
        //     try {
        //         const response = await fetch(`/user/${email}`);
        //         const data = await response.json();
        //         const userNameContainer = document.getElementById('userName');
        //         userNameContainer.textContent = data.username;
        //     } catch (error) {
        //         console.error('Error fetching user name:', error);
        //     }
        // }

        // const userEmail = 'shashi@gmail.com';
        // fetchUserName(userEmail);

        // const userEmail = 'shashi@gmail.com';

        // Fetch user data
        // async function fetchUserData() {
        //     try {
        //         const token = document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/, "$1");
        //         const headers = { Authorization: `Bearer ${token}` };
        //         const response = await fetch(`/user/${userEmail}`, { headers });
        //         const data = await response.json();
        //         const userNameContainer = document.getElementById('userName');
        //         userNameContainer.textContent = data.username;
        //     } catch (error) {
        //         console.error('Error fetching user data:', error);
        //     }
        // }
        // Fetch and display user details


        async function fetchUserDetails() {
            try {
                // const token = document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/, "$1");
                // const headers = { Authorization: `Bearer ${token}` };

                const token = document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/, "$1");

                console.log("Token:", token);
                const headers = { Authorization: `Bearer ${token}` };

                // const response = await fetch('/user/me', { headers }); // Use the '/user/me' route to get current user details
                const data = await response.json();

                const userNameContainer = document.getElementById('userName');
                // const emailContainer = document.getElementById('userEmail'); // Add an element for displaying email
                userNameContainer.textContent = data.username;
                // emailContainer.textContent = data.email;

            } catch (error) {
                console.error('Error fetching user details:', error);
            }
        }

        fetchUserDetails();

        // async function fetchUserDetails() {
        //     const token = document.cookie.split(';')
        //         .map(cookie => cookie.trim())
        //         .find(cookie => cookie.startsWith('token='))
        //         .split('=')[1];

        //     if (!token) {
        //         console.error("Token missing");
        //         return;
        //     }

        //     console.log("Document cookie:", document.cookie);
        //     console.log("Extracted token:", token);

        //     try {
        //         const response = await fetch('/user/me', {
        //             method: 'GET',
        //             headers: {
        //                 Authorization: `Bearer ${token}`
        //             }
        //         });

        //         if (!response.ok) {
        //             console.error("Error fetching user details:", response.statusText);
        //             return;
        //         }

        //         const user = await response.json();
        //         document.getElementById('userName').textContent = user.username;
        //     } catch (error) {
        //         console.error("Error fetching user details:", error);
        //     }
        // }

        // // Call fetchUserDetails when the profile page loads
        // window.onload = fetchUserDetails;

    </script>

</body>

</html>